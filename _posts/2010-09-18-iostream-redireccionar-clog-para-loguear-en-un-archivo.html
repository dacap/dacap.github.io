---
layout: post
title: Iostream - Redireccionar clog para "loguear" en un archivo
date: 2010-09-18
category: cpp
tags: [cpp, programacion, iostream]
---

<div class='post'>
La <a href="http://www.cplusplus.com/reference/iostream/">iostream</a> es la librería de entrada y salida de C++. Existen algunos <a href="http://en.wikipedia.org/wiki/Standard_streams">streams estándares</a> de salida: std::cout, std::cerr y std::clog. El primero apunta a la consola, y los dos últimos... también. Las diferencias son estas:<br /><ul><li>cout apunta a la salida estándar STDOUT (texto de resultado esperado de un programa);<br /><li>cerr y clog apuntan a STDERR (salida de errores y cualquier otra porquería).<br /></ul>Aunque a primera vista todo el texto se envía a la consola, uno puede redireccionar la salida a otros lados. Por ejemplo, imaginemos que tenemos el siguiente programa test.exe:<pre class="prettyprint">#include &lt;iostream&gt;<br /><br />using namespace std;<br /><br />int main()<br />{<br />  cout &lt;&lt; "A\n";<br />  cerr &lt;&lt; "B\n";<br />  clog &lt;&lt; "C\n";<br />  return 0;<br />}</pre>Al ejecutarlo, obtenemos por pantalla las tres líneas:<pre class="console">test.exe [ENTER]<br />A<br />B<br />C<br /></pre>Pero resulta interesante saber que podemos redireccionar el STDOUT a un archivo y el STDERR a otro. Ejemplo:<pre class="console">test.exe 1>stdout.txt 2>stderr.txt</pre>¿Qué demonios es 1 y 2? Los archivos tienen un <a href="http://en.wikipedia.org/wiki/File_descriptor">descriptor que los identifica</a>, 1 es para la STDOUT, y 2 para STDERR. El signo mayor (&gt;) significa que "quiero redireccionar toda la salida de texto que vaya para este descriptor a este archivo". En el anterior ejemplo logramos obtener dos archivos distintos, stdout.txt que contiene una línea (A), y stderr.txt que contiene dos líneas (B y C).<p>Generalmente, los <a href="http://en.wikipedia.org/wiki/Server_log">logs</a> van a un archivo, no a la pantalla. Aunque por defecto clog mande todo a STDERR, resulta útil redireccionar este stream a un archivo propio (por ejemplo, test.log). De esta forma, podemos hacer uso de clog para "loguear" todo lo que nuestro programa hace.<p><b>¿Cómo se redirecciona clog?</b> Básicamente los streams de C++ tienen un <a href="http://www.cplusplus.com/reference/iostream/streambuf/">streambuf</a> asociado, y éste es el realmente encargado de leer y escribir datos (en la pantalla, en un archivo, en un string en memoria, etc.). Por lo tanto, si creamos un fstream y le colocamos su propio streambuf a clog, podemos usar clog como un "alias" del fstream original (clog va a estar compartiendo el mismo streambuf que el fstream). El código resultante es bastante sencillo:<pre class="prettyprint">#include &lt;iostream&gt;<br />#include &lt;fstream&gt;<br /><br />using namespace std;<br /><br />int main()<br />{<br />  // Creamos un archivo de salida para logging.<br />  ofstream test_log;<br />  test_log.open("test.log");<br /><br />  // Obtenemos el streambuf actual de clog (esto<br />  // lo usaremos luego para restaurar el streambuf<br />  // a su valor original, por si las moscas).<br />  streambuf* old_rdbuf = clog.rdbuf();<br /><br />  // Reemplazamos el streambuf de clog con el del archivo.<br />  // Ahora ambos streams utilizarán el mismo streambuf (es<br />  // decir, escriben en el archivo test.log).<br />  clog.rdbuf(test_log.rdbuf());<br /><br />  // Hacemos lo mismo que el ejemplo original.<br />  cout &lt;&lt; "A\n";<br />  cerr &lt;&lt; "B\n";<br />  clog &lt;&lt; "C\n";<br />  <br />  // Restauramos el viejo streambuf de clog.<br />  clog.rdbuf(old_rdbuf);<br /><br />  // Cerramos el archivo.<br />  test_log.close();<br />  return 0;<br />}</pre>Y listo, ahora podemos hacer lo mismo que antes:<pre class="console">test.exe 1>stdout.txt 2>stderr.txt</pre>Con lo cual obtenemos tres archivos:<ul><li>stdout.txt con la línea A.<br /><li>stderr.txt con la línea B.<br /><li>test.log con la línea C.<br /></ul>
</div>
