---
layout: post
title: Compilando archivos
date: 2008-05-10
category: cpp
tags: [cpp, programacion, compilar, gcc]
---

<div class='post'>
Suponiendo que conoce qué es un archivo de <a href="http://es.wikipedia.org/wiki/C%C3%B3digo_fuente">código fuente</a>, <a href="http://es.wikipedia.org/wiki/C%C3%B3digo_objeto">código objeto</a>, un <a href="http://es.wikipedia.org/wiki/Ejecutable">ejecutable</a> <a href="http://es.wikipedia.org/wiki/EXE"><b>.exe</b></a>, y el <a href="http://es.wikipedia.org/wiki/C%C3%B3digo_m%C3%A1quina">código máquina</a>; voy a pasar a explicar algunos comandos del <a href="http://es.wikipedia.org/wiki/GCC">GCC</a> para compilar.<br /><br />Retomando la idea del <a href="http://cmasomenos.blogspot.com/2008/03/medir-el-tiempo-de-una-rutina.html">anterior post</a>, imagínese que creamos un archivo <a href="http://davidcapello.googlepages.com/timemark.h">timemark.h</a> para darle un poco de portabilidad a todo este asunto de medir el desempeño de una rutina. Las declaraciones de timemark.h pueden ser usadas para crear un pequeño programa <a href="http://davidcapello.googlepages.com/ejemplo1.c">ejemplo1.c</a> que sea independiente de la plataforma (por lo menos entre Windows y GNU/Linux).<br /><br />Vamos a probar algunas operaciones sobre la línea de comandos para ver cómo compilar este archivo. Inicialmente, la opción más sencilla es utilizar directamente "gcc ejemplo1.c", esto nos da como resultado el archivo "a.exe" o "a.out". Veamos (teniendo <em>timemark.h</em> y <em>ejemplo1.c</em> en un directorio <em>C:\ejemplo1</em>):<br /><pre class="source-code">C:\ejemplo1&gt;gcc ejemplo1.c<br />C:/Temp/ccMjdaaa.o:ejemplo1.c:(.text+0x31): undefined reference to `get_timemark'<br />C:/Temp/ccMjdaaa.o:ejemplo1.c:(.text+0x3c): undefined reference to `get_timemark'<br />C:/Temp/ccMjdaaa.o:ejemplo1.c:(.text+0x4e): undefined reference to `timemark_diff'<br />collect2: ld returned 1 exit status<br /></pre>Como podrá ver, recibimos un error por las funciones no definidas <em>get_timermark</em> y <em>timemark_diff</em>. Esto se debe a que utilizando solamente "gcc ejemplo1.c", se intenta enlazar el código de ese único archivo en el ejecutable. Tenemos algunas opciones intermedias antes de crear el .exe final. Por ejemplo, podemos crear un archivo que contenga el código objeto ya compilado (pero únicamente del archivo en cuestión <em>ejemplo1.c</em>):<br /><pre class="source-code">C:\ejemplo1&gt;gcc -o ejemplo1.o -c ejemplo1.c<br /></pre>Así obtenemos el <em>ejemplo1.o</em> (código objeto). En este caso no recibimos errores ya que <em>ejemplo1.o</em> hace referencias a las funciones <em>get_timermark</em> y <em>timemark_diff</em>, pero no necesita su implementación específica. Cuando creamos el ejecutable final (<em>.exe</em>) es cuando realmente necesitamos el código de todas las funciones invocadas.<br /><br />El archivo que falta es <a href="http://davidcapello.googlepages.com/timemark.c">timemark.c</a>. Del mismo modo, podemos compilarlo con el comando:<br /><pre class="source-code">C:\ejemplo1&gt;gcc -o timemark.o -c timemark.c<br /></pre>Ahora resta unir ambos archivos objetos en un único ejecutable, con un único punto de acceso (<em>main</em>):<br /><pre class="source-code">C:\ejemplo1&gt;gcc -o ejemplo.exe ejemplo1.o timemark.o<br /></pre>Y listo. Por ahora, lo aprendido son estos dos comandos:<br /><pre class="source-code">gcc -o archivo.o -c archivo.c<br />gcc -o archivo.exe archivo1.o archivo2.o archivo3.o ...<br /></pre>El primero compila el código fuente para generar un archivo objeto, y el segundo comando reune (enlaza, <em>linkea</em>) el grupo de archivos objetos en un ejecutable único.<br /><br />De todas formas, es bastante tedioso escribir estos comandos cada vez que queremos compilar. Para resolver el problema podemos utilizar los llamados Makefiles. Claro, lo más interesante queda para un futuro post.
</div>
